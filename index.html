<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>VR Phone Camera HUD</title>
<style>
  html,body { height:100%; margin:0; background:#000; color:#fff; font-family:system-ui, -apple-system, sans-serif; overflow:hidden; }
  #container { width:100%; height:100vh; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; }
  .eyeCanvas { background:#000; position:absolute; }
  .menuBtn { background:linear-gradient(135deg,#222,#555); color:#fff; border:none; padding:8px 12px; border-radius:6px; font-size:14px; cursor:pointer; margin:4px; }
  .menuSlider { width:120px; }
  .menuBox { background:rgba(0,0,0,0.7); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:6px; pointer-events:auto; }
  #menuOverlay { position:absolute; pointer-events:none; }
</style>
</head>
<body>
<div id="container">
  <canvas id="left" class="eyeCanvas"></canvas>
  <canvas id="right" class="eyeCanvas"></canvas>
</div>
<video id="video" autoplay playsinline muted style="display:none;"></video>
<div id="menuOverlay"></div>

<script>
const video = document.getElementById('video');
const leftCanvas = document.getElementById('left');
const rightCanvas = document.getElementById('right');
const menuOverlay = document.getElementById('menuOverlay');

let stream = null, rafId = null, zoom = 1, eyeGap = 20;
let menuVisible = false, menuAngle = 0, deviceYaw = 0, devicePitch = 0, lastTap = 0;

// Menu UI Elements
const menuBox = document.createElement('div'); menuBox.className='menuBox';
const startBtn = document.createElement('button'); startBtn.className='menuBtn'; startBtn.textContent='Start Camera';
const flipBtn = document.createElement('button'); flipBtn.className='menuBtn'; flipBtn.textContent='Flip Camera';
const fsBtn = document.createElement('button'); fsBtn.className='menuBtn'; fsBtn.textContent='Fullscreen';
const zoomSlider = document.createElement('input'); zoomSlider.type='range'; zoomSlider.min='1'; zoomSlider.max='2'; zoomSlider.step='0.01'; zoomSlider.value='1'; zoomSlider.className='menuSlider';
const fpsSlider = document.createElement('input'); fpsSlider.type='range'; fpsSlider.min='30'; fpsSlider.max='120'; fpsSlider.step='30'; fpsSlider.value='30'; fpsSlider.className='menuSlider';
menuBox.appendChild(startBtn); menuBox.appendChild(flipBtn); menuBox.appendChild(fsBtn);
menuBox.appendChild(document.createTextNode('Zoom')); menuBox.appendChild(zoomSlider);
menuBox.appendChild(document.createTextNode('FPS')); menuBox.appendChild(fpsSlider);
menuOverlay.appendChild(menuBox);
menuOverlay.style.display='none'; menuOverlay.style.pointerEvents='auto';

function stopStream(){ if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null;} if(rafId){ cancelAnimationFrame(rafId); rafId=null;}}
async function startCameraFunc(){ stopStream(); try{ const constraints={audio:false,video:{facingMode:{ideal:'environment'},width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:parseInt(fpsSlider.value,10)}}}; stream=await navigator.mediaDevices.getUserMedia(constraints); video.srcObject=stream; await video.play(); resizeCanvases(); drawLoop();}catch(err){alert('Camera error:'+err.message||err);}}
async function flipCamera(){ stopStream(); try{ const mode = video.srcObject.getVideoTracks()[0].getSettings().facingMode==='environment'?'user':'environment'; const constraints={audio:false,video:{facingMode:{ideal:mode},width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:parseInt(fpsSlider.value,10)}}}; stream=await navigator.mediaDevices.getUserMedia(constraints); video.srcObject=stream; await video.play(); resizeCanvases();}catch(err){console.error(err);}}
function toggleFullscreen(){ if(!document.fullscreenElement){ document.body.requestFullscreen?.(); }else{ document.exitFullscreen?.(); }}

startBtn.onclick=startCameraFunc; flipBtn.onclick=flipCamera; fsBtn.onclick=toggleFullscreen;
zoomSlider.oninput=e=>{ zoom=parseFloat(e.target.value); }; fpsSlider.oninput=e=>{ if(stream){ const track=stream.getVideoTracks()[0]; if(track.applyConstraints) track.applyConstraints({frameRate:{ideal:parseInt(fpsSlider.value,10),max:parseInt(fpsSlider.value,10)}}); }}

function resizeCanvases(){ const dpr=window.devicePixelRatio||1; const w=window.innerWidth,h=window.innerHeight; const scale=0.85; const eyeW=Math.floor(w*scale/2), eyeH=Math.floor(h*scale); leftCanvas.style.width=rightCanvas.style.width=eyeW+'px'; leftCanvas.style.height=rightCanvas.style.height=eyeH+'px'; leftCanvas.width=rightCanvas.width=Math.floor(eyeW*dpr); leftCanvas.height=rightCanvas.height=Math.floor(eyeH*dpr); const totalWidth=eyeW*2+eyeGap; leftCanvas.style.left=`calc(50% - ${totalWidth/2}px)`; rightCanvas.style.left=`calc(50% - ${totalWidth/2}px + ${eyeW + eyeGap}px)`; leftCanvas.style.top=rightCanvas.style.top=`calc(50% - ${eyeH/2}px)`;}
window.addEventListener('resize',resizeCanvases);
function ensureRotated(svw,svh){if(svh<=svw) return {src:video,w:svw,h:svh}; if(rotCanvas.width!==svh||rotCanvas.height!==svw){rotCanvas.width=svh; rotCanvas.height=svw;} rotCtx.save(); rotCtx.clearRect(0,0,rotCanvas.width,rotCanvas.height); rotCtx.translate(rotCanvas.width,0); rotCtx.rotate(Math.PI/2); rotCtx.drawImage(video,0,0,svw,svh); rotCtx.restore(); return {src:rotCanvas,w:rotCanvas.width,h:rotCanvas.height};}

let landscape=true;
window.addEventListener('orientationchange',()=>{ landscape=window.orientation===90||window.orientation===-90; });
window.addEventListener('deviceorientation', e=>{ const alpha = e.alpha||0, beta=e.beta||0, gamma=e.gamma||0; if(landscape){ deviceYaw=alpha; devicePitch=beta;}else{deviceYaw=alpha; devicePitch=gamma;}});

window.addEventListener('pointerdown', e=>{ const now=Date.now(); if(now-lastTap<300){ menuVisible=!menuVisible; menuOverlay.style.display=menuVisible?'block':'none'; if(menuVisible) menuAngle=deviceYaw; } lastTap=now; });

function drawMenu(ctx,canvas){ if(!menuVisible) return; const centerX=canvas.width/2, centerY=canvas.height/2; const radius=200; const yawOffset=((menuAngle-deviceYaw+360)%360)*Math.PI/180; const pitchOffset=(0-devicePitch)*Math.PI/180; const x=centerX+radius*Math.sin(yawOffset)-menuBox.offsetWidth/2; const y=centerY-radius*Math.sin(pitchOffset)-menuBox.offsetHeight/2; menuBox.style.transform=`translate(${x}px,${y}px)`;}

function drawCrosshair(ctx){
  const cx=ctx.canvas.width/2, cy=ctx.canvas.height/2;
  let hover=false;
  if(menuVisible){ const rect=menuBox.getBoundingClientRect(); if(cx>=rect.left && cx<=rect.right && cy>=rect.top && cy<=rect.bottom){ hover=true; }}
  ctx.fillStyle='white'; ctx.beginPath(); ctx.arc(cx,cy, hover?8:5,0,2*Math.PI); ctx.fill();
}

function checkCrosshairClick(){ if(!menuVisible) return; const rect=menuBox.getBoundingClientRect(); const cx=window.innerWidth/2, cy=window.innerHeight/2; if(cx>=rect.left && cx<=rect.right && cy>=rect.top && cy<=rect.bottom){ const elements=menuBox.children; for(let el of elements){ if(el.tagName==='BUTTON') el.click(); }} }
window.addEventListener('click', checkCrosshairClick);

function drawLoop(){ const ctxL=leftCanvas.getContext('2d'), ctxR=rightCanvas.getContext('2d'); const svw=video.videoWidth, svh=video.videoHeight; if(!svw||!svh){ rafId=requestAnimationFrame(drawLoop); return; } const {src,w,h}=ensureRotated(svw,svh); [ctxL,ctxR].forEach(ctx=>{ ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height); const sw=w/zoom, sh=h/zoom, sx=(w-sw)/2, sy=(h-sh)/2; ctx.drawImage(src,sx,sy,sw,sh,0,0,ctx.canvas.width,ctx.canvas.height); drawCrosshair(ctx); }); drawMenu(ctxL,leftCanvas); rafId=requestAnimationFrame(drawLoop);}

startCameraFunc();
</script>
</body>
</html>
